{% extends 'menu/base.html' %}
{% load menu_tags %}

{% block title %}{% if user_menu_language == 'lt' %}Peržiūrėti dienos meniu{% else %}Preview Daily Menu{% endif %}{% endblock %}

{% block extra_css %}
<style>
    .preview-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 2rem;
        padding-bottom: 1rem;
        border-bottom: 2px solid #e0e0e0;
    }
    .preview-date {
        font-size: 1.5rem;
        font-weight: 600;
        color: #2c3e50;
    }
    .preview-actions {
        display: flex;
        gap: 1rem;
    }
    .menu-category-section {
        margin-bottom: 3rem;
    }
    .category-title {
        font-size: 1.8rem;
        font-weight: 700;
        color: #2c3e50;
        margin-bottom: 1.5rem;
        padding-bottom: 0.5rem;
        border-bottom: 3px solid #27ae60;
    }
    .menu-items {
        display: flex;
        flex-direction: column;
        gap: 1.5rem;
    }
    .menu-item {
        padding: 1rem;
        background: #fafafa;
        border-radius: 8px;
        transition: all 0.2s;
    }
    .menu-item:hover {
        background: #f0f0f0;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    .menu-item-content {
        width: 100%;
    }
    .menu-item-header {
        display: flex;
        justify-content: space-between;
        align-items: baseline;
        margin-bottom: 0.5rem;
    }
    .menu-item-name {
        font-size: 1.2rem;
        font-weight: 600;
        color: #2c3e50;
        margin: 0;
    }
    .menu-item-price {
        font-size: 1.1rem;
        font-weight: 700;
        color: #27ae60;
        text-align: right;
        display: flex;
        flex-direction: column;
        gap: 0.25rem;
    }
    .menu-item-price span {
        display: block;
    }
    .menu-item-price div {
        display: block;
    }
    .menu-item-description {
        color: #555;
        font-size: 0.95rem;
        line-height: 1.6;
        margin: 0;
    }
    .empty-menu {
        text-align: center;
        padding: 3rem;
        color: #7f8c8d;
        font-size: 1.1rem;
    }
</style>
{% endblock %}

{% block content %}
<div class="card">
    <div class="preview-header">
        <div>
            <div class="preview-date">
                {% if user_menu_language == 'lt' %}Dienos meniu{% else %}Daily Menu{% endif %} - {{ daily_menu.date|date:"Y-m-d" }}
            </div>
            {% if not daily_menu.published %}
            <div style="color: #e74c3c; font-size: 0.9rem; margin-top: 0.5rem;">
                {% if user_menu_language == 'lt' %}(Nepaskelbtas){% else %}(Not Published){% endif %}
            </div>
            {% endif %}
        </div>
        <div class="preview-actions">
            <a href="{% url 'user_menu:daily_menu_edit' daily_menu.pk %}" class="btn">
                {% if user_menu_language == 'lt' %}Grįžti į redagavimą{% else %}Back to Edit{% endif %}
            </a>
        </div>
    </div>

    {% if dishes_by_category %}
        {% for category, menu_dishes in dishes_by_category.items %}
        <div class="menu-category-section">
            <h2 class="category-title">{{ category|get_name:user_menu_language }}</h2>
            <div class="menu-items">
                {% for menu_dish in menu_dishes %}
                <div class="menu-item">
                    <div class="menu-item-content">
                        <div class="menu-item-header">
                            <h4 class="menu-item-name">{{ menu_dish.dish|get_name:user_menu_language }}</h4>
                            <div class="menu-item-price">
                                {% if menu_dish.dish.half_price %}
                                    {% if user_menu_language == 'lt' %}
                                        <div>½ porcijos: €{{ menu_dish.dish.half_price }}</div>
                                        <div>Pilna porcija: €{{ menu_dish.dish.price }}</div>
                                    {% else %}
                                        <div>½ size: €{{ menu_dish.dish.half_price }}</div>
                                        <div>Full size: €{{ menu_dish.dish.price }}</div>
                                    {% endif %}
                                {% else %}
                                    <span>€{{ menu_dish.dish.price }}</span>
                                {% endif %}
                            </div>
                        </div>
                        {% with ingredients=menu_dish.dish|get_ingredients_strict:user_menu_language %}
                        {% if ingredients %}
                        <p class="menu-item-description">{{ ingredients }}</p>
                        {% endif %}
                        {% endwith %}
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endfor %}
    {% endif %}

    {% if complex_display_data %}
    <div class="menu-category-section">
        <h2 class="category-title">{% if user_menu_language == 'lt' %}Kompleksai{% else %}Complexes{% endif %}</h2>
        <div class="menu-items">
            {% for complex_item in complex_display_data %}
            <div class="menu-item">
                <div class="menu-item-content">
                    <div class="menu-item-header">
                        <h4 class="menu-item-name">{{ complex_item.display_name }}</h4>
                        <span class="menu-item-price">€{{ complex_item.price }}</span>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    {% if not dishes_by_category and not complex_display_data %}
        <div class="empty-menu">
            {% if user_menu_language == 'lt' %}
                Šiame meniu nėra prieinamų patiekalų ar kompleksų. Pridėkite patiekalus/kompleksus ir pažymėkite juos kaip prieinamus, kad jie būtų matomi peržiūroje.
            {% else %}
                No available dishes or complexes in this menu. Add dishes/complexes and mark them as available to see them in the preview.
            {% endif %}
        </div>
    {% endif %}
</div>
{% endblock %}
